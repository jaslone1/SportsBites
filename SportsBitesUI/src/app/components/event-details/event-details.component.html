<div *ngIf="event; else loading" class="container mt-4 mb-5">

  <div class="d-flex justify-content-between align-items-start mb-3">
    <div>
      <h2 class="text-primary mb-0">{{ event.eventName }}</h2>
      <p class="lead text-muted">{{ event.gameDetails }}</p>
    </div>

    <div class="text-end">
      <span *ngIf="event.isFinalized" class="badge bg-dark mb-2">ğŸ”’ Locked</span>
      <span *ngIf="!event.isPublic" class="badge bg-info d-block">ğŸ•µï¸ Private Event</span>
    </div>
  </div>

  <div *ngIf="event.isFinalized" class="alert alert-success border-0 shadow-sm mb-4">
    <i class="bi bi-info-circle-fill me-2"></i> The host has finalized this menu. You can still claim unclaimed items!
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-white font-weight-bold">
      <h4 class="mb-0">Food Suggestions</h4>
    </div>
    <div class="list-group list-group-flush">
      <div *ngFor="let food of event.foodSuggestions" class="list-group-item d-flex justify-content-between align-items-center py-3">
        <div>
          <h5 class="mb-1">{{ food.foodName }}</h5>
          <small class="text-muted">Suggested by: {{ food.suggestedByName }}</small>

          <div class="mt-2">
            <span *ngIf="food.claimedByName" class="badge rounded-pill bg-success">
              <i class="bi bi-person-check"></i> Coming from: {{ food.claimedByName }}
            </span>
            <span *ngIf="!food.claimedByName" class="badge rounded-pill bg-light text-dark border">
              âœ‹ Needs someone to bring this!
            </span>
          </div>
        </div>

        <div class="d-flex align-items-center">
          <button *ngIf="authService.isLoggedIn() && !event.isFinalized"
                  (click)="onVote(food.foodSuggestionId)"
                  class="btn btn-link text-decoration-none p-0 me-3">
            <i [class]="food.hasUserUpvoted ? 'bi bi-heart-fill text-danger' : 'bi bi-heart text-secondary'" style="font-size: 1.2rem;"></i>
            <span class="ms-1 text-dark">{{ food.upvoteCount }}</span>
          </button>

          <ng-container *ngIf="authService.isLoggedIn(); else guestClaimView">
            <button *ngIf="!food.claimedByName"
                    (click)="onClaim(food.foodSuggestionId)"
                    class="btn btn-sm btn-primary">
              Claim This!
            </button>
            <button *ngIf="food.claimedByName === currentUserName"
                    (click)="onUnclaim(food.foodSuggestionId)"
                    class="btn btn-sm btn-outline-danger">
              Unclaim
            </button>
          </ng-container>

          <ng-template #guestClaimView>
            <span *ngIf="!food.claimedByName" class="text-muted small italic">
              (Login to claim)
            </span>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="authService.isLoggedIn() && !event.isFinalized" class="card border-primary shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title text-primary">Add a Food Suggestion</h5>
      <div class="input-group">
        <input type="text" [(ngModel)]="newFoodName" class="form-control" placeholder="Wings, Pizza, etc...">
        <button (click)="suggestFood()" class="btn btn-primary px-4">Add</button>
      </div>
    </div>
  </div>

  <div *ngIf="currentUserId === event.hostUserId" class="card border-warning mb-4">
    <div class="card-body bg-light d-flex justify-content-between align-items-center">
      <div><strong>Host Controls:</strong></div>
      <div>
        <button (click)="onFinalize()" class="btn btn-warning btn-sm me-2">
          {{ event.isFinalized ? 'ğŸ”“ Re-open Suggestions' : 'ğŸ”’ Finalize Menu' }}
        </button>
        <button (click)="onDelete()" class="btn btn-danger btn-sm">Delete Event</button>
      </div>
    </div>
  </div>

  <div class="text-muted small mt-5">Messages to be added later...</div>
</div>

<ng-template #loading>
  <div class="text-center mt-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="text-muted">Loading game day details...</p>
  </div>
</ng-template>
