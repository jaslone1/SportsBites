@page "/"
@using GameDayParty.Shared
@inject HttpClient Http
@inject NavigationManager Navigation

<PageTitle>SportsBites - Home</PageTitle>

<div class="container mt-4">
    <div class="jumbotron p-5 mb-4 bg-light rounded-3 shadow-sm">
        <h1 class="display-4">Welcome to SportsBites!</h1>
        <p class="lead">Join a party, suggest some food, and see what's winning the leaderboard.</p>
    </div>
    
   <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Upcoming Parties</h3>
        <button class="btn btn-primary" @onclick='() => Navigation.NavigateTo("/create-event")'>
            + Create New Party
        </button>
    </div>

    <h3>Upcoming Parties</h3>

    @if (events == null)
    {
        <p><em>Loading parties...</em></p>
    }
    else if (!events.Any())
    {
        <div class="alert alert-info">No parties scheduled yet. Time to host one!</div>
    }
    else
    {
        <div class="row">
            @foreach (var ev in events)
            {
                <div class="col-md-4 mb-3">
                    <div class="card h-100 shadow-sm hover-shadow" @onclick="() => GoToDetails(ev.EventId)" style="cursor: pointer;">
                        <div class="card-body">
                            <h5 class="card-title text-primary">@ev.EventName</h5>
                            <h6 class="card-subtitle mb-2 text-muted">Host: @ev.HostName</h6>
                            <p class="card-text text-truncate">@ev.GameDetails</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-secondary">@ev.EventDate.ToShortDateString()</span>
                                <button class="btn btn-sm btn-outline-primary">View Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@code {
    private List<EventDto>? events;

    protected override async Task OnInitializedAsync()
    {
        // This assumes you have a GET api/events that returns all events
        events = await Http.GetFromJsonAsync<List<EventDto>>("api/events");
    }

    private void GoToDetails(int id)
    {
        Navigation.NavigateTo($"/event/{id}");
    }
}